@using  mobilehome.insure.Helper.Extensions
@model mobilehome.insure.Models.Rental.RentalViewModel.Quote
@{
    Layout = null;
}

<div class="col-md-9 m-right">
    <div id="rightcontainer">
        @using (Html.BeginForm("_Step2", "Rental"))
        {
            <div class="col-md-8">
                <div class="row" data-animated="0">

                    @Html.HiddenFor(x => x.CustomerId)

                    <div class="form-group">
                        @Html.LabelFor(x => x.EffectiveDate)
                        @Html.TextBoxFor(x => x.EffectiveDate, new { @class = "form-control", value="" })
                        @Html.ValidationMessageFor(x => x.EffectiveDate, "", new { @class = "text-danger" })
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(x => x.PersonalProperty)
                        @Html.TextBoxFor(x => x.PersonalProperty, new { @class = "form-control" })
                        @Html.ValidationMessageFor(x => x.PersonalProperty, "", new { @class = "text-danger" })
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(x => x.Liability)
                        @Html.TextBoxFor(x => x.Liability, new { @class = "form-control" })
                        @Html.ValidationMessageFor(x => x.Liability, "", new { @class = "text-danger" })
                    </div>

                    @*<div class="form-group">
                        @Html.LabelFor(x => x.Deductible)
                        @Html.HiddenFor(x => x.Deductible, new { @class = "form-control" })

                    </div>*@

                    <div class="form-group">
                        @Html.LabelFor(x => x.NumberOfInstallments)
                        @Html.DropDownListFor(x => x.NumberOfInstallments, new SelectList(Model.InstallmentList), "Please Select", new { @class = "form-control" })
                        @Html.ValidationMessageFor(x => x.NumberOfInstallments, "", new { @class = "text-danger" })
                    </div>

                    <div class="form-group">

                        Premium: <label id="lblPremium" />

                    </div>

                    <div class="form-action" style="float:left">
                        <button class="btn btn-default" id="btnQuote">Calculate</button>
                    </div>
                    <div style="float:left">
                        &nbsp;<button class="btn btn-default" id="btnContinuePayment">Continue</button>
                    </div>
                </div>
            </div>
            @Html.ValidationSummary(true)
        }
    </div>
</div>

@Html.Script(

    @<script>
        $(document).ready(function () {

            $("#EffectiveDate").datepicker();
            $("#btnContinuePayment").prop('disabled', true);

            $("#btnContinuePayment").click(function (evt) {
                evt.preventDefault();
                $("#accordion").accordion("destroy");
                $("#accordion").accordion({
                    heightStyle: "content",
                    active: 2
                });
            });

            $("#btnQuote").click(function (evt) {
                evt.preventDefault();
                var $form = $('form');


                if ($form.valid()) {
                    $('#dvLoading').show();

                    var ajaxOptions = {};
                    ajaxOptions.data = JSON.stringify({
                        EffectiveDate: $("#EffectiveDate").val(),
                        PersonalProperty: $("#PersonalProperty").val(),
                        Liability: $("#Liability").val()

                    });
                    ajaxOptions.url = "/Rental/_Step2";
                    ajaxOptions.method = "POST";
                    ajaxOptions.dataType = "JSON";
                    ajaxOptions.contentType = 'application/json';
                    var request = $.ajax(ajaxOptions);

                    request.done(function (result) {
                        $("#lblPremium").text('$' + result);
                        $("#btnContinuePayment").prop('disabled', false);
                        $('#dvLoading').hide();
                    });

                    request.fail(function (jqXHR, textStatus) {
                        alert("Request failed: " + textStatus);
                    });



                }


            });
        });

    </script>
)